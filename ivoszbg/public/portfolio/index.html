<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">








    






<link rel="icon" type="image/ico" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="http://localhost:1313/android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/apple-touch-icon.png">

<meta name="description" content=""/>



<title>
    
    My work | Ivaylo Ivanov
    
</title>

<link rel="canonical" href="http://localhost:1313/portfolio/"/>

<meta property="og:url" content="http://localhost:1313/portfolio/">
  <meta property="og:site_name" content="Ivaylo Ivanov">
  <meta property="og:title" content="My work">
  <meta property="og:description" content="Linux # The Powkiddy X51 handheld console is relatively hard to develop mainline Linux for, because there are no official kernel sources, nor any kind of documentations for this platform. Both Powkiddy and Actions Semiconductor ignored all my emails, so a lot of things had to be reverse-engineered. Thankfully there also ancient kernel sources for a somewhat similar platform, from where I can borrow information about some registers.
There are still some essential things that have to be brought up. For example:">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:published_time" content="2024-09-25T18:47:52+03:00">
    <meta property="article:modified_time" content="2024-09-25T18:47:52+03:00">












<link rel="stylesheet" href="/assets/combined.min.c84ef7d767cb9811a35d21d1f0bcb15f49465c1e026bee0cce5f22e22a0d327c.css" media="all">











    




</head>







<body class="dark">

  <div class="content">
    <header>
      

<div class="header">

    

    <h1 class="header-title">
        <a href="http://localhost:1313/">Ivaylo Ivanov</a>
    </h1>

    <div class="header-menu">
        

        
        

        <p
            class="small ">
            <a href="/" >
                /home
            </a>
        </p>
        

        <p
            class="small ">
            <a href="/blog" >
                /blogs
            </a>
        </p>
        

        <p
            class="small ">
            <a href="/portfolio" >
                /achievements
            </a>
        </p>
        
        
    </div>

    

</div>

    </header>

    <main class="main">
      




<div class="breadcrumbs"><a href="/">Home</a><span class="breadcrumbs-separator">/</span>
        <a href="/portfolio/">My work</a></div>


<div >
  <article>
    <header class="single-intro-container">
        
        <h1 class="single-title">My work</h1>
        
        <div class="single-subsummary">
          
          <div>
            
            <p class="single-date">
              <time datetime="2024-09-25T18:47:52&#43;03:00">September 25, 2024</time>
            </p>
          </div>
        </div>
        
    </header>
    
    <div class="single-content">
      <hr>
<h2 class="heading" id="linux">
  Linux
  <a class="anchor" href="#linux">#</a>
</h2>
<p>The Powkiddy X51 handheld console is relatively hard to develop mainline Linux for, because there are no official kernel sources, nor any kind of documentations for this platform. Both Powkiddy and Actions Semiconductor ignored all my emails, so a lot of things had to be reverse-engineered. Thankfully there also ancient kernel sources for a somewhat similar platform, from where I can borrow information about some registers.</p>
<p>There are still some essential things that have to be brought up. For example:</p>
<ul>
<li>due to the lack of information I only managed to write a partial pinctrl driver. It doesn&rsquo;t include any pin groups nor funcs, only gpio.</li>
<li>the SDMMC might be a bit difficult to bring up. Device trees suggest that ATM7051 isn&rsquo;t using DMA for that, which is a bit&hellip; weird. The upstream driver only has DMA support.</li>
<li>there&rsquo;s absolutely no nand drivers for Actions SoCs. Anywhere. And I&rsquo;m not gonna put in the effort to reverse engineer it for such a weak platform.</li>
<li>the GPU driver isn&rsquo;t open sourced. We can use proprietary blobs with hacks, but that&rsquo;ll never land in mainline.</li>
<li>the keys aren&rsquo;t wired through GPIO, but the pmic. That&rsquo;s bad since we only have regulators functionality for the PMIC upstream.</li>
</ul>
<p>











<figure class="">

    <div class="img-container" >
        <img loading="lazy" alt="alt" src="/images/bringing-mainline-linux-to-life-on-atm7051-handhelds-v0-rp5vjhpag0ld1.webp" >
    </div>

    
</figure>
</p>
<hr>
<p>The Samsung Galaxy Xcover 3 Value edition, alongside the other devices with this SoC, have reached a point where they are close to being usable on my 6.11 kernel fork, with important hardware blocks like the Display engine, GPU, touchscreen and WIFI/BT working. Nevertheless it still has some issues that need resolving:</p>
<ul>
<li>SMP isn&rsquo;t fully working and heavy wayland DEs like phosh are a bit unstable.</li>
<li>the DWC2 usb is.. weird.</li>
</ul>
<p>It still has to undergo upstreaming. Here&rsquo;s some pictures <a href="https://i.imgur.com/fyVvY6o.mp4">and a short video showcasing hardware accelerated phosh.</a></p>
<div style="display: flex; justify-content: space-between; align-items: center;">
    <div style="flex: 1; padding-right: 10px;">
        <figure class="">

    <div class="img-container" >
        <img loading="lazy" alt="alt" src="/images/xcover3ve_2.jpg" >
    </div>

    
</figure>
    </div>
    <div style="flex: 1;">
        <figure class="">

    <div class="img-container" >
        <img loading="lazy" alt="alt" src="/images/xcover3ve_1.jpg" >
    </div>

    
</figure>
    </div>
</div>


<hr>
<p>The Samsung Galaxy S8 is definitely not an easy platform to work on. As a high-end exynos SoCs (even though it&rsquo;s from 2017), it has complex peripherals and a large amount of buses like I2Cs, UARTs, HSI2Cs. Some more things need to be brought up, like:</p>
<ul>
<li>the SPEEDY bus, which is used for PMIC</li>
<li>UFS</li>
<li>DECON</li>
<li>Mali G71 via Panfrost</li>
</ul>
<div style="display: flex; justify-content: space-between; align-items: center;">
    <div style="flex: 1; padding-right: 10px;">
        <figure class="">

    <div class="img-container" >
        <img loading="lazy" alt="alt" src="/images/s8_1.jpg" >
    </div>

    
</figure>
    </div>
    <div style="flex: 1;">
        
    </div>
</div>


<hr>
<p>MSM8x12 series SoCs are a cut-off version of MSM8x74. MSM8x12 feature 4 cores and MSM8x10 only 2. The biggest issue currently is that mainline does not have support for MDP3, which means that I&rsquo;ll have to write a driver for it if we want a working panel driver. Meanwhile the Adreno GPU should be doable with a small amount of changes, simpleDRM and a small hack that allows MESA to use simpleDRM.</p>
<p>All progress for {MSM8x10, MSM8x12} has been done under the <a href="https://github.com/Mainline4Lumia">Mainline4Lumia project</a>.</p>
<div style="display: flex; justify-content: space-between; align-items: center;">
    <div style="flex: 1; padding-right: 10px;">
        <figure class="">

    <div class="img-container" >
        <img loading="lazy" alt="alt" src="/images/535_1.jpeg" >
    </div>

    
</figure>
    </div>
    <div style="flex: 1;">
        <figure class="">

    <div class="img-container" >
        <img loading="lazy" alt="alt" src="/images/435_1.jpg" >
    </div>

    
</figure>
    </div>
</div>


<hr>
<h1 class="heading" id="uniloader">
  uniLoader
  <a class="anchor" href="#uniloader">#</a>
</h1>
<p><a href="https://github.com/ivoszbg/uniLoader">uniLoader</a> is a secondary bootloader that is capable of booting the upstream Linux kernel for Android and iOS-based devices. It allows embedding the kernel and DTB to it, making it a very minimalistic bootloader that doesn&rsquo;t require complex hardware drivers for stuff like storage. In fact, even MMU does not get enabled.</p>
<p>The purpose behind it is to provide a small shim for avoiding vendors&rsquo; bootloader quirks. For example:</p>
<ul>
<li>Exynos devices past 2016 leave decon&rsquo;s framebuffer refreshing disabled right before jumping to kernel, which makes initial debugging efforts when bringing up the platform to upstream linux hard</li>
<li>Some S-Boot releases have CNTFRQ_EL0 left unset, which causes issues since the linux timer driver cannot read its value and it SErrors. It either has to be set as a hardcoded frequency property in the DT, or passed via libfdt from uniLoader (the latter is cleaner, but still has to be implemented)</li>
</ul>
<p>The currently supported architectures are ARMV7 and AARCH64. Here&rsquo;s a list of the currently supported devices:</p>
<ul>
<li>Apple iPhone 6</li>
<li>Samsung Galaxy Note 5</li>
<li>Samsung Galaxy Note 20</li>
<li>Samsung Galaxy A8 2018</li>
<li>Samsung Galaxy S6</li>
<li>Samsung Galaxy S8</li>
<li>Samsung Galaxy S9</li>
<li>Samsung Galaxy S20</li>
<li>Samsung Galaxy J4</li>
<li>Samsung Galaxy J5 2015</li>
<li>Samsung Galaxy Tab S6 Lite</li>
</ul>
<hr>
<h1 class="heading" id="u-boot">
  U-Boot
  <a class="anchor" href="#u-boot">#</a>
</h1>
<p>In order to avoid the stock BL&rsquo;s limitations, I&rsquo;ve gotten u-boot working on few devices:</p>
<h2 class="heading" id="iphone-5">
  iPhone 5
  <a class="anchor" href="#iphone-5">#</a>
</h2>
<p>There were many issues. To begin with, S5L8950x either entirely doesn&rsquo;t have VBAR, or Apple&rsquo;s implementation of it is broken, so I had to disable it. Then there were a ton of small issues here and there, which I fixed thankfully due to an emulator that I specifically wrote for S5L8950x, called &ldquo;Legacy Apple Emulator&rdquo;. Then I had another memory issue, where parsing the framebuffer address via DT was broken, so I had to fix that as well. And finally I brought up USB! - well, partially, since it probably needs some PHY and DWC2 config work. Only USB plug-in detection works for now.
<div style="display: flex; justify-content: space-between; align-items: center;">
    <div style="flex: 1; padding-right: 10px;">
        <figure class="">

    <div class="img-container" >
        <img loading="lazy" alt="alt" src="/images/iphone5_u-boot.jpg" >
    </div>

    
</figure>
    </div>
    <div style="flex: 1;">
        <figure class="">

    <div class="img-container" >
        <img loading="lazy" alt="alt" src="/images/LAEMU.jpg" >
    </div>

    
</figure>
    </div>
</div>

</p>
<h2 class="heading" id="xcover-3-value-edition-powkiddy-x51">
  Xcover 3 Value Edition, Powkiddy X51
  <a class="anchor" href="#xcover-3-value-edition-powkiddy-x51">#</a>
</h2>
<div style="display: flex; justify-content: space-between; align-items: center;">
    <div style="flex: 1; padding-right: 10px;">
        <figure class="">

    <div class="img-container" >
        <img loading="lazy" alt="alt" src="/images/xcover3ve_u-boot.jpg" >
    </div>

    
</figure>
    </div>
    <div style="flex: 1;">
        <figure class="">

    <div class="img-container" >
        <img loading="lazy" alt="alt" src="/images/atm7051_u-boot.png" >
    </div>

    
</figure>
    </div>
</div>



    </div>
  </article>

  

  

  
  

  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


    </main>
  </div>

  
  





    




  <footer>
    

    
    





    




    
    <p>Powered by
        <a href="https://gohugo.io/">Hugo</a>
        and
        <a href="https://github.com/tomfran/typo">tomfran/typo</a>
    </p>
    
    
    


  </footer>

  
</body>

<script src="/js/theme-switch.js"></script>
<script defer src="/js/copy-code.js"></script>
</html>
